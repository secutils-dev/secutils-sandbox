<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT Debugger - Clone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jose/4.14.4/index.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --header-color: #fb7185; /* rose-400 */
            --payload-color: #c084fc; /* purple-400 */
            --signature-color: #60a5fa; /* blue-400 */
        }
        body { font-family: 'Inter', sans-serif; }
        .token-input, .json-editor, #secret-input {
            font-family: 'Fira Code', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        .token-part-header { color: var(--header-color); }
        .token-part-payload { color: var(--payload-color); }
        .token-part-signature { color: var(--signature-color); }
        .token-dot { color: #9ca3af; }
        .json-editor {
            min-height: 200px;
            background-color: #1f2937;
            border-color: #374151;
            color: #d1d5db;
        }
        .json-editor:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 2px #4f46e5;
        }
        .json-editor.invalid { border-color: #f87171; }
        .tab-btn {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #9ca3af; /* gray-400 */
        }
        .tab-btn.active {
            color: #e5e7eb; /* gray-200 */
            border-color: #4f46e5; /* indigo-500 */
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex flex-col">
    <header class="bg-gray-900/80 backdrop-blur-sm border-b border-gray-700/50 sticky top-0 z-10">
        <div class="container mx-auto px-4 py-3 flex items-center gap-4">
             <svg height="24" role="img" viewBox="0 0 98 16"><path fill="#fed047" d="M3 0h10c1.662 0 3 1.338 3 3v10c0 1.662-1.338 3-3 3H3c-1.662 0-3-1.338-3-3V3c0-1.662 1.338-3 3-3"></path><path fill="#642340" d="M11.285 12q-1.12 0-1.728-.608-.608-.619-.608-1.675v-5.61h1.152v5.6q0 .597.299.938.298.342.885.342t.885-.342.299-.938v-5.6h1.152v5.61q0 1.067-.608 1.675T11.285 12m-6.368 0q-1.152 0-1.845-.608t-.694-1.664H3.51q0 .587.384.928.384.33 1.024.33.63 0 .992-.34.363-.342.363-.907 0-.427-.235-.747t-.672-.437l-1.12-.299q-.79-.213-1.248-.779-.448-.565-.448-1.354 0-.64.277-1.11.288-.48.811-.746T4.853 4t1.216.267q.533.266.821.746.3.47.3 1.099H6.057q0-.501-.341-.8-.33-.31-.864-.31t-.864.31q-.32.299-.32.79 0 .394.213.66.224.267.619.374l1.152.31q.81.213 1.28.831t.47 1.462q0 .693-.31 1.205-.31.501-.864.779Q5.674 12 4.917 12" aria-label="SU"></path><path fill="#fff" d="M93.158 12.117 91.185 4.33h1.173l1.259 5.184q.117.47.202.918t.128.693q.043-.245.128-.693.096-.459.214-.928l1.205-5.174h1.184l-1.984 7.787zm-7.83 0V4.33h4.577v1.024h-3.446v2.219h3.072v.992H86.46v2.528h3.446v1.024zm-6.517 0V4.33h2.176q.768 0 1.334.299.565.288.874.832.32.533.32 1.248v3.008q0 .736-.32 1.27-.31.533-.875.831-.565.299-1.333.299zm1.152-1.035h1.024q.63 0 1.003-.362.373-.363.373-1.003V6.709q0-.619-.373-.981-.373-.374-1.003-.374h-1.024zm-5.237 1.142q-.416 0-.683-.246-.256-.256-.256-.672t.256-.672q.267-.266.683-.266t.672.266q.266.256.266.672t-.266.672q-.256.246-.672.246m-6.368 0q-1.152 0-1.845-.608t-.694-1.664h1.13q0 .586.385.928.384.33 1.024.33.63 0 .992-.341.363-.341.363-.907 0-.426-.235-.746t-.672-.438l-1.12-.298q-.79-.214-1.248-.78-.448-.564-.448-1.354 0-.64.277-1.11.288-.48.81-.746.524-.266 1.217-.266t1.216.266q.533.267.821.747.299.47.299 1.099H69.5q0-.502-.342-.8-.33-.31-.864-.31t-.864.31q-.32.298-.32.789 0 .395.213.661.224.267.619.374l1.152.309q.81.213 1.28.832t.47 1.461q0 .694-.31 1.206-.31.5-.864.778-.555.278-1.312.278m-8.288-.107V4.33h1.152v6.742h3.403v1.045zm-6.699 0v-1.045h1.568V5.376h-1.568V4.33h4.32v1.046h-1.579v5.696h1.58v1.045zm-4.821 0V5.376h-2.08V4.33h5.322v1.046h-2.09v6.74zm-5.824.107q-1.12 0-1.728-.608-.608-.62-.608-1.675V4.33h1.152v5.6q0 .597.298.938.299.341.886.341.586 0 .885-.341t.299-.939v-5.6h1.152v5.61q0 1.068-.608 1.676t-1.728.608m-6.315 0q-1.099 0-1.75-.608-.64-.62-.64-1.664V6.496q0-1.056.64-1.664.651-.608 1.75-.608 1.088 0 1.728.618.65.608.65 1.654h-1.151q0-.608-.331-.928-.32-.32-.896-.32-.587 0-.917.32-.32.32-.32.928v3.456q0 .608.32.928.33.32.917.32.576 0 .896-.32.33-.32.33-.928h1.153q0 1.045-.651 1.664-.64.608-1.728.608m-8.683-.107V4.33h4.576v1.024H28.86v2.219h3.072v.992h-3.072v2.528h3.445v1.024zm-4.17.107q-1.152 0-1.846-.608-.693-.608-.693-1.664h1.13q0 .586.385.928.384.33 1.024.33.629 0 .992-.341.362-.341.362-.907 0-.426-.234-.746t-.672-.438l-1.12-.298q-.79-.214-1.248-.78-.448-.564-.448-1.354 0-.64.277-1.11.288-.48.81-.746.523-.266 1.217-.266.693 0 1.216.266.533.267.821.747.299.47.299 1.099h-1.131q0-.502-.341-.8-.331-.31-.864-.31t-.864.31q-.32.298-.32.789 0 .395.213.661.224.267.619.374l1.152.309q.81.213 1.28.832.469.619.469 1.461 0 .694-.31 1.206-.309.5-.863.778-.555.278-1.312.278" aria-label="SECUTILS.DEV"></path></svg>
            <div>
                <h1 class="text-2xl font-bold text-white">JWT Debugger</h1>
                <p class="text-gray-400 text-sm mt-1">Decode, Verify, and Generate JWTs.</p>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 flex-grow">
        <div class="mb-6 flex justify-center">
             <div class="w-full max-w-sm">
                <label for="algorithm-select" class="block text-sm font-medium text-gray-400 mb-2">Algorithm</label>
                <select id="algorithm-select" class="w-full bg-gray-800 border border-gray-700 rounded-md px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option>HS256</option>
                    <option>HS384</option>
                    <option>HS512</option>
                    <option disabled>--- RS/ES/PS algorithms require key pairs ---</option>
                </select>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="flex flex-col">
                <h2 class="text-lg font-semibold mb-2 text-white">Encoded</h2>
                <div class="relative flex-grow">
                    <div id="encoded-output" contenteditable="true" spellcheck="false" class="token-input w-full h-full bg-gray-800 border border-gray-700 rounded-md p-4 text-left whitespace-pre-wrap break-all focus:outline-none focus:ring-2 focus:ring-indigo-500 min-h-[400px]"></div>
                     <div class="absolute top-2 right-2 flex gap-2">
                        <button id="share-button" class="bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-1 px-3 rounded-md text-sm transition-colors">Share</button>
                        <button id="copy-button" class="bg-gray-700 hover:bg-gray-600 text-gray-300 font-semibold py-1 px-3 rounded-md text-sm transition-colors">Copy</button>
                    </div>
                </div>
            </div>
            <div class="flex flex-col gap-6">
                <div><h2 class="text-lg font-semibold text-white">Decoded</h2></div>
                <!-- Header -->
                <div class="bg-gray-800/50 border border-gray-700/50 rounded-lg shadow-sm">
                    <div class="p-4 border-b border-gray-700/50"><h3 class="font-semibold" style="color: var(--header-color);">HEADER: ALGORITHM & TOKEN TYPE</h3></div>
                    <div class="p-4">
                        <div class="border-b border-gray-700 mb-2"><nav class="flex" id="header-tabs"></nav></div>
                        <div id="header-tab-content"></div>
                    </div>
                </div>
                <!-- Payload -->
                <div class="bg-gray-800/50 border border-gray-700/50 rounded-lg shadow-sm">
                    <div class="p-4 border-b border-gray-700/50"><h3 class="font-semibold" style="color: var(--payload-color);">PAYLOAD: DATA</h3></div>
                    <div class="p-4">
                        <div class="border-b border-gray-700 mb-2"><nav class="flex" id="payload-tabs"></nav></div>
                        <div id="payload-tab-content"></div>
                    </div>
                </div>
                <!-- Signature -->
                <div class="bg-gray-800/50 border border-gray-700/50 rounded-lg shadow-sm">
                    <div class="p-4 border-b border-gray-700/50"><h3 class="font-semibold" style="color: var(--signature-color);">VERIFY SIGNATURE</h3></div>
                    <div class="p-4">
                        <textarea id="secret-input" spellcheck="false" placeholder="Your-256-bit-secret" class="json-editor w-full border rounded-md p-3 focus:outline-none h-24"></textarea>
                        <div id="signature-status" class="mt-4 text-center font-semibold py-2 px-4 rounded-md text-sm"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center py-4 text-gray-500 text-sm">
        <p>A single-file JWT.io clone created by Gemini.</p>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const algorithmSelect = document.getElementById('algorithm-select');
    const encodedOutput = document.getElementById('encoded-output');
    const secretInput = document.getElementById('secret-input');
    const signatureStatus = document.getElementById('signature-status');
    const copyButton = document.getElementById('copy-button');
    const shareButton = document.getElementById('share-button');

    const defaultState = {
        header: { alg: 'HS256', typ: 'JWT' },
        payload: { sub: '1234567890', name: 'John Doe', iat: Math.floor(Date.now() / 1000) },
        secret: 'your-secret-key'
    };

    const JWT_CLAIMS = {
        iss: '(Issuer) Claim', sub: '(Subject) Claim', aud: '(Audience) Claim',
        exp: '(Expiration Time) Claim', nbf: '(Not Before) Claim', iat: '(Issued At) Claim', jti: '(JWT ID) Claim'
    };

    const base64UrlDecode = (str) => {
        str = str.replace(/-/g, '+').replace(/_/g, '/');
        while (str.length % 4) { str += '='; }
        try { return decodeURIComponent(escape(atob(str))); } catch (e) { return null; }
    };

    const updateSignatureStatusUI = (isValid) => {
        signatureStatus.textContent = isValid ? 'Signature Verified' : 'Invalid Signature';
        signatureStatus.className = `mt-4 text-center font-semibold py-2 px-4 rounded-md text-sm ${isValid ? 'bg-green-500/20 text-green-300' : 'bg-red-500/20 text-red-300'}`;
    };

    const updateDecodedFromToken = () => {
        const token = encodedOutput.innerText;
        const parts = token.split('.');
        if (parts.length !== 3) {
            updateSignatureStatusUI(false);
            return;
        }

        try {
            const headerJson = JSON.parse(base64UrlDecode(parts[0]));
            document.getElementById('decoded-header').value = JSON.stringify(headerJson, null, 2);
            populateTable('header-claims-table', headerJson);
        } catch (e) {
            document.getElementById('decoded-header').value = base64UrlDecode(parts[0]);
            populateTable('header-claims-table', null);
        }

        try {
            const payloadJson = JSON.parse(base64UrlDecode(parts[1]));
            document.getElementById('decoded-payload').value = JSON.stringify(payloadJson, null, 2);
            populateTable('payload-claims-table', payloadJson);
        } catch (e) {
            document.getElementById('decoded-payload').value = base64UrlDecode(parts[1]);
            populateTable('payload-claims-table', null);
        }

        verifyToken();
    };

    const updateEncoded = async () => {
        const header = JSON.parse(document.getElementById('decoded-header').value);
        const payload = JSON.parse(document.getElementById('decoded-payload').value);
        if (!header || !payload) {
            encodedOutput.innerText = 'Invalid JSON';
            updateSignatureStatusUI(false);
            return;
        }
        if (header.alg !== algorithmSelect.value) {
            header.alg = algorithmSelect.value;
            document.getElementById('decoded-header').value = JSON.stringify(header, null, 2);
        }
        try {
            const secretKey = new TextEncoder().encode(secretInput.value);
            const jwt = await new jose.SignJWT(payload).setProtectedHeader(header).sign(secretKey);
            const parts = jwt.split('.');
            encodedOutput.innerHTML = `<span class="token-part-header">${parts[0]}</span><span class="token-dot">.</span><span class="token-part-payload">${parts[1]}</span><span class="token-dot">.</span><span class="token-part-signature">${parts[2]}</span>`;
            updateSignatureStatusUI(true);
        } catch (err) {
            encodedOutput.textContent = `Error: ${err.message}`;
            updateSignatureStatusUI(false);
        }
    };
    
    const verifyToken = async () => {
        const token = encodedOutput.innerText;
        const secret = secretInput.value;
        if (!token || !secret || token.split('.').length !== 3) {
            updateSignatureStatusUI(false); return;
        }
        try {
            const secretKey = new TextEncoder().encode(secret);
            await jose.jwtVerify(token, secretKey, { algorithms: [algorithmSelect.value] });
            updateSignatureStatusUI(true);
        } catch (err) { updateSignatureStatusUI(false); }
    };
    
    const populateTable = (tableBodyId, data) => {
        const tbody = document.getElementById(tableBodyId);
        tbody.innerHTML = '';
        if (!data || typeof data !== 'object') return;
        for (const key in data) {
            const row = tbody.insertRow();
            const cellKey = row.insertCell();
            const cellValue = row.insertCell();
            cellKey.className = "px-2 py-1 font-mono text-sm text-gray-400";
            cellValue.className = "px-2 py-1 font-mono text-sm text-gray-200";

            let keyHtml = `<div>${key}</div>`;
            if(JWT_CLAIMS[key]) {
                keyHtml += `<div class="text-xs text-gray-500">${JWT_CLAIMS[key]}</div>`;
            }
            cellKey.innerHTML = keyHtml;

            let value = data[key];
            if ((key === 'iat' || key === 'exp' || key === 'nbf') && typeof value === 'number') {
                cellValue.textContent = `${value} (${new Date(value * 1000).toUTCString()})`;
            } else {
                 cellValue.textContent = JSON.stringify(value);
            }
        }
    };

    const createTabs = (containerId, contentContainerId, idPrefix) => {
        const tabsContainer = document.getElementById(containerId);
        const contentDiv = document.getElementById(contentContainerId);
        tabsContainer.innerHTML = `
            <button class="tab-btn active" data-tab="${idPrefix}-json">JSON</button>
            <button class="tab-btn" data-tab="${idPrefix}-table">Table</button>`;
        contentDiv.innerHTML = `
            <div id="${idPrefix}-json" class="tab-content active">
                <textarea id="decoded-${idPrefix}" spellcheck="false" class="json-editor w-full border rounded-md p-3 focus:outline-none"></textarea>
            </div>
            <div id="${idPrefix}-table" class="tab-content">
                <table class="w-full text-left border-collapse">
                    <tbody id="${idPrefix}-claims-table"></tbody>
                </table>
            </div>`;

        tabsContainer.addEventListener('click', e => {
            if (e.target.classList.contains('tab-btn')) {
                tabsContainer.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                contentDiv.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(e.target.dataset.tab).classList.add('active');
            }
        });

        document.getElementById(`decoded-${idPrefix}`).addEventListener('input', () => {
            try {
                const jsonData = JSON.parse(document.getElementById(`decoded-${idPrefix}`).value);
                populateTable(`${idPrefix}-claims-table`, jsonData);
                updateEncoded();
            } catch (e) {
                // Invalid JSON, don't update
            }
        });
    };

    createTabs('header-tabs', 'header-tab-content', 'header');
    createTabs('payload-tabs', 'payload-tab-content', 'payload');
    
    algorithmSelect.addEventListener('change', updateEncoded);
    secretInput.addEventListener('input', updateEncoded);
    encodedOutput.addEventListener('input', updateDecodedFromToken);
    
    copyButton.addEventListener('click', () => {
        navigator.clipboard.writeText(encodedOutput.innerText).then(() => {
            copyButton.textContent = 'Copied!';
            setTimeout(() => { copyButton.textContent = 'Copy'; }, 2000);
        });
    });

    shareButton.addEventListener('click', () => {
        const jwtValue = encodedOutput.innerText.trim();
        if (!jwtValue || jwtValue === 'Invalid JSON') return;

        const secretValue = secretInput.value.trim();

        const encodedJwtForUrl = encodeURIComponent(jwtValue);
        const encodedSecretForUrl = encodeURIComponent(secretValue);
        const shareUrl = `${window.location.origin}${window.location.pathname}?jwt=${encodedJwtForUrl}&secret=${encodedSecretForUrl}`;

        navigator.clipboard.writeText(shareUrl).then(() => {
            shareButton.textContent = 'Link Copied!';
            setTimeout(() => {
                shareButton.textContent = 'Share';
            }, 2000);
        });
    });

    const initialize = () => {
        const urlParams = new URLSearchParams(window.location.search);

        const secretFromQuery = urlParams.get('secret');
        if (secretFromQuery != null) {
            secretInput.value = secretFromQuery;
        }

        const jwtFromQuery = urlParams.get('jwt');
        if (jwtFromQuery) {
            encodedOutput.innerText = jwtFromQuery;
            updateDecodedFromToken();
        } else {
            document.getElementById('decoded-header').value = JSON.stringify(defaultState.header, null, 2);
            document.getElementById('decoded-payload').value = JSON.stringify(defaultState.payload, null, 2);
            populateTable('header-claims-table', defaultState.header);
            populateTable('payload-claims-table', defaultState.payload);
            secretInput.value = defaultState.secret;
            algorithmSelect.value = defaultState.header.alg;
            updateEncoded();
        }
    };
    initialize();
});
</script>

</body>
</html>